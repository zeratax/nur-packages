{ lib, stdenv, fetchurl, server-type ? "spigot" }:
let
  pname = "dynmap";
  version = "3.2.1";
  hashes = {
    # generated by running ./get_hashes.sh 3.2.1
    "spigot" = "1wmg3g668jj8mqd4v9jbpkabvmj321f4a9hz0931jfpmjfsj2klz";
    "fabric-1.15.2" = "1jd9q165g8yls1nwds232vv8dfx5zh2f4cnn4rxi7a7i6sc1n81f";
    "fabric-1.16.1" = "1jn5ppbcr37qkik3s9dfxia5fnmgd051nw6gz3498ghkq2r0b1zv";
    "fabric-1.16.2" = "0n08kfdkqk717siqyf9wj6afpk205nw192kasqq9hgvsp0hhjvzl";
    "fabric-1.16.4" = "0figmar1ysxg2q56xam0r27fxw9hdz00cfg502flv1wfkm58jnsm";
    "forge-1.11.2" = "0grk2kdy2dh4dgjmjpkqrngl0k5c1jgain6n6z7pddsvnzcfhiia";
    "forge-1.12.2" = "1xd5mgy6m44pglq7qapah07l5f3mmk8sf1a3f34q82ajan0c6ni6";
    "forge-1.13.2" = "0l3hvfgf06f0vxwly8hzxkkyfh92l5mnz5srhpl4hpy0dgjy2lb6";
    "forge-1.14.4" = "1xnl06ij6k2y52fqvnkn28i4whndvcvh4ik7f81l3aphid7dl08j";
    "forge-1.15.2" = "12ragp7c0szbbgvrkyjn94w7cg5srwv85q13wy0g9m2p1lh6rvsp";
    "forge-1.16.1" = "0gfrax12a3kn04hqmf4mcys36anm8fkxsxvwdxg23xi41abwlax7";
    "forge-1.16.2" = "0apqnfkxnp0j6rbg160pprbp9xmnvcwi0q2013hzkvxjkmwpy4pf";
    "forge-1.16.3" = "1f07jry614i25sdz3h3qks1wlf9284h01hikk5cw1wmw5rprmppz";
    "forge-1.16.4" = "0340qns6da2ihkisdgy6nh3p19jmf29ai4x72pvbpgbm0czwbj33";
    "forge-1.16.5" = "12lph5bhzirb4nr1j9klk706gxhnaqcysgdlc30c29gxc66dl6w3";
  };
  jar = fetchurl {
    url = if (version == "3.1-beta-7") then
      "https://github.com/webbukkit/${pname}/releases/download/v${version}/Dynmap-3.1-beta7-${server-type}.jar"
    else
      "https://github.com/webbukkit/${pname}/releases/download/v${version}/Dynmap-${version}-${server-type}.jar";
    sha256 = lib.attrsets.getAttrFromPath [ server-type ] hashes;
  };
in stdenv.mkDerivation rec {
  inherit version pname;

  preferLocalBuild = true;

  dontUnpack = true;
  dontConfigure = true;

  installPhase = ''
    mkdir -p $out
    cp ${jar} $out/${pname}.jar
  '';

  meta = with lib; {
    homepage = "https://github.com/webbukkit/dynmap";
    description =
      " A set of Minecraft mods that provide a real time web-based map system for various Minecraft server implementations.";
    license = licenses.asl20;
    # maintainers = with maintainers; [ zeratax ];
  };
}
